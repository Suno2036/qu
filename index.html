<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–≤–∞–¥–µ–±–Ω–∞—è —Ñ–æ—Ç–æ–±—É–¥–∫–∞ –ò–ª—å–∏ –∏ –ê–ª–∏–Ω—ã</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ, —Ä–æ—Å–∫–æ—à–Ω–æ–≥–æ –≤–∏–¥–∞ */
        body {
            font-family: 'Poppins', sans-serif;
            touch-action: manipulation;
            background: linear-gradient(to bottom right, #0a0a0a, #1a1a1a);
        }
        .font-wedding-title {
            font-family: 'Dancing Script', cursive;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        #camera-view {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 1rem;
            transform: scaleX(-1); /* –ó–µ—Ä–∫–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —Å–µ–ª—Ñ–∏ */
        }
        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 1.5rem;
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
            z-index: 50;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .hidden {
            display: none;
        }
        .bg-glass {
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="bg-gray-900 flex flex-col min-h-screen text-gray-200">

    <!-- –ó–∞—Å—Ç–∞–≤–∫–∞ —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º -->
    <div id="splash-screen" class="fixed inset-0 bg-gray-900 flex flex-col items-center justify-center z-50 transition-opacity duration-1000">
        <img src="https://placehold.co/200x200/B8860B/ffffff?text=IA" alt="Logo" class="animate-pulse mb-8 rounded-full" onerror="this.onerror=null;this.src='https://placehold.co/200x200/000000/FFFFFF?text=Error';">
        <p class="text-xl text-gray-400">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç–æ) -->
    <div id="main-app-content" class="hidden flex-grow flex flex-col">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ -->
        <header class="text-center p-6 bg-glass rounded-b-3xl shadow-lg sticky top-0 z-10">
            <h1 class="font-wedding-title text-5xl sm:text-6xl font-bold text-pink-400">
                –ò–ª—å—è & –ê–ª–∏–Ω–∞
            </h1>
            <p class="mt-2 text-gray-400 text-sm sm:text-base">
                –û—Å—Ç–∞–≤—å—Ç–µ –Ω–∞–º —Å–≤–æ–µ —Ñ–æ—Ç–æ –Ω–∞ –ø–∞–º—è—Ç—å!
            </p>
        </header>

        <main class="flex-grow p-4 sm:p-6 flex flex-col items-center">
            <!-- –°–µ–∫—Ü–∏—è —Ñ–æ—Ç–æ–±—É–¥–∫–∏ (–æ—Å–Ω–æ–≤–Ω–∞—è –∫–∞–º–µ—Ä–∞) -->
            <div id="camera-section" class="w-full max-w-2xl mt-8 mb-8 bg-glass rounded-3xl shadow-xl p-4 sm:p-6 fade-in">
                <h2 class="text-3xl font-bold text-center mb-4 text-pink-400">–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ</h2>
                <!-- –í–∏–¥ —Å –∫–∞–º–µ—Ä—ã -->
                <div class="w-full relative overflow-hidden rounded-xl mb-4" style="padding-top: 75%;">
                    <video id="camera-view" class="absolute inset-0" playsinline autoplay></video>
                    <div id="countdown" class="absolute inset-0 flex items-center justify-center text-white text-9xl font-bold opacity-0 transition-opacity duration-300"></div>
                </div>
                <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                <div class="flex justify-center items-center space-x-4">
                    <button id="capture-btn" class="flex-grow py-3 px-6 bg-gradient-to-r from-pink-500 to-rose-500 text-white rounded-full shadow-lg transition-transform transform hover:scale-105 active:scale-95 text-lg font-semibold">
                        –°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ
                    </button>
                </div>
            </div>

            <!-- –°–µ–∫—Ü–∏—è —Ñ–æ—Ç–æ–≥–∞–ª–µ—Ä–µ–∏ -->
            <div id="photos-container" class="w-full max-w-4xl mt-6">
                <h2 class="text-3xl font-bold text-center mb-6 text-pink-400">–ì–∞–ª–µ—Ä–µ—è</h2>
                <div id="photo-grid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 fade-in">
                    <!-- –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—é–¥–∞ -->
                    <p class="text-center text-gray-500 col-span-full">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π...</p>
                </div>
            </div>
        </main>

        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
        <div id="message-box" class="message-box text-center p-6 hidden">
            <p id="message-box-text" class="font-medium"></p>
        </div>

        <!-- –§—É—Ç–µ—Ä -->
        <footer class="text-center p-4 text-gray-500 text-sm">
            &copy; 2024 –°–≤–∞–¥–µ–±–Ω–∞—è —Ñ–æ—Ç–æ–±—É–¥–∫–∞. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
        </footer>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç
        document.addEventListener('DOMContentLoaded', () => {
            // –≠–ª–µ–º–µ–Ω—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            const splashScreen = document.getElementById('splash-screen');
            const mainAppContent = document.getElementById('main-app-content');
            const photosContainer = document.getElementById('photo-grid');
            const captureBtn = document.getElementById('capture-btn');
            const cameraView = document.getElementById('camera-view');
            const countdown = document.getElementById('countdown');
            const messageBox = document.getElementById('message-box');
            const messageBoxText = document.getElementById('message-box-text');

            // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            let db;
            let auth;
            let userId;
            let appInitialized = false; // –§–ª–∞–≥ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é —Å—Ä–µ–¥–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Firebase, –µ—Å–ª–∏ –æ–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–∞
            const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
              // –í–ê–®–ò –ö–õ–Æ–ß–ò FIREBASE (–µ—Å–ª–∏ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è —Å—Ä–µ–¥–æ–π)
              apiKey: "YOUR_API_KEY",
              authDomain: "YOUR_AUTH_DOMAIN",
              projectId: "YOUR_PROJECT_ID",
              storageBucket: "YOUR_STORAGE_BUCKET",
              messagingSenderId: "YOUR_SENDER_ID",
              appId: "YOUR_APP_ID"
            };

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–µ—Ä–≤–∏—Å—ã Firebase
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –∑–∞—Å—Ç–∞–≤–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
            function hideSplashScreen() {
                splashScreen.style.opacity = '0';
                setTimeout(() => {
                    splashScreen.classList.add('hidden');
                    mainAppContent.classList.remove('hidden');
                }, 1000); // –û–∂–∏–¥–∞–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –∑–∞—Ç—É—Ö–∞–Ω–∏—è
            }

            // –ü–æ–∫–∞–∑–∞—Ç—å –∏ —Å–∫—Ä—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
            function showMessage(text, isTemporary = true) {
                messageBoxText.textContent = text;
                messageBox.classList.remove('hidden');
                if (isTemporary) {
                    setTimeout(() => {
                        messageBox.classList.add('hidden');
                    }, 3000);
                }
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            async function initApp() {
                if (appInitialized) return; // –ï—Å–ª–∏ —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ, –≤—ã—Ö–æ–¥–∏–º
                appInitialized = true;

                try {
                    await initCamera();
                    setupPhotoListener();
                    hideSplashScreen();
                } catch (e) {
                    console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:", e);
                    let errorMsg = "–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏.";
                    if (e.name === 'NotAllowedError') {
                        errorMsg = "–î–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞.";
                    } else if (e.name === 'NotFoundError') {
                        errorMsg = "–ö–∞–º–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.";
                    } else if (e.name === 'NotReadableError') {
                        errorMsg = "–ö–∞–º–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥—Ä—É–≥–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º.";
                    }
                    showMessage(errorMsg, false);
                    hideSplashScreen(); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–≤–∏–¥–µ–ª –æ—à–∏–±–∫—É
                }
            }

            // –°–ª—É—à–∞—Ç–µ–ª—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ—à–µ–ª –≤ —Å–∏—Å—Ç–µ–º—É.
                    userId = user.uid;
                    console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω:", userId);
                    initApp(); // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                } else {
                    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–æ—à–µ–ª –≤ —Å–∏—Å—Ç–µ–º—É.
                    console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω, –ø–æ–ø—ã—Ç–∫–∞ –∞–Ω–æ–Ω–∏–º–Ω–æ–≥–æ –≤—Ö–æ–¥–∞.");
                }
            });

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞
            async function attemptSignIn() {
                try {
                    // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                    if (auth.currentUser) {
                         console.log("–ù–∞–π–¥–µ–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.");
                         initApp(); // –ï—Å–ª–∏ –¥–∞, —Å—Ä–∞–∑—É –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º
                         return;
                    }
                    // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç, –ø—ã—Ç–∞–µ–º—Å—è –≤–æ–π—Ç–∏
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        await signInWithCustomToken(auth, __initial_auth_token);
                    } else {
                        await signInAnonymously(auth);
                    }
                    // onAuthStateChanged –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç —É—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ –∏ –≤—ã–∑–æ–≤–µ—Ç initApp
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ Firebase:", error);
                    showMessage("–û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.", false);
                    captureBtn.disabled = true;
                    hideSplashScreen(); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–∫–∏
                }
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –≤—Ö–æ–¥–∞
            attemptSignIn();


            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–º–µ—Ä—ã
            async function initCamera() {
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    throw new Error("–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ.");
                }
                
                let stream;
                // –°–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –ø–µ—Ä–µ–¥–Ω–µ–π –∫–∞–º–µ—Ä–µ (–¥–ª—è —Å–µ–ª—Ñ–∏)
                try {
                    stream = await navigator.mediaDevices.getUserMedia({ 
                        video: { 
                            facingMode: 'user',
                            width: { ideal: 1920 },
                            height: { ideal: 1080 }
                        } 
                    });
                } catch (err) {
                    console.warn("–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–µ—Ä–µ–¥–Ω–µ–π –∫–∞–º–µ—Ä–µ, –ø–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–∞–¥–Ω—é—é:", err);
                    // –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å, –ø—Ä–æ–±—É–µ–º –∑–∞–¥–Ω—é—é
                    try {
                        stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                    } catch (e) {
                        throw e; // –ï—Å–ª–∏ –æ–±–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å
                    }
                }
                
                if (stream) {
                    cameraView.srcObject = stream;
                    await cameraView.play();
                } else {
                    throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –ø–æ—Ç–æ–∫ —Å –∫–∞–º–µ—Ä—ã.");
                }
            }
            
            // –¢–∞–π–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞
            function startCountdown() {
                captureBtn.disabled = true;
                let count = 3;
                countdown.textContent = count;
                countdown.classList.remove('opacity-0');

                const timer = setInterval(() => {
                    count--;
                    if (count > 0) {
                        countdown.textContent = count;
                    } else {
                        clearInterval(timer);
                        countdown.textContent = 'üì∏'; // –°–º–∞–π–ª–∏–∫ –≤ –º–æ–º–µ–Ω—Ç —Å—ä–µ–º–∫–∏
                        takePhoto();
                        setTimeout(() => {
                           countdown.classList.add('opacity-0');
                           captureBtn.disabled = false;
                        }, 1000);
                    }
                }, 1000);
            }

            // –°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Firestore
            async function takePhoto() {
                const canvas = document.createElement('canvas');
                const videoWidth = cameraView.videoWidth;
                const videoHeight = cameraView.videoHeight;

                canvas.width = videoWidth;
                canvas.height = videoHeight;
                const context = canvas.getContext('2d');

                // –£—á–∏—Ç—ã–≤–∞–µ–º –∑–µ—Ä–∫–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                context.translate(videoWidth, 0);
                context.scale(-1, 1);
                context.drawImage(cameraView, 0, 0, videoWidth, videoHeight);

                const imageDataUrl = canvas.toDataURL('image/jpeg', 0.9); // –°–∂–∞—Ç–∏–µ JPEG
                
                showMessage("–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ...", false);

                try {
                    const photosRef = collection(db, `artifacts/${appId}/public/data/wedding-photos`);
                    await addDoc(photosRef, {
                        photoData: imageDataUrl,
                        timestamp: new Date().toISOString(),
                    });
                    showMessage("–§–æ—Ç–æ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ!", true);
                } catch (e) {
                    showMessage("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ç–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.", true);
                    console.error("–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞: ", e);
                }
            }
            
            // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
            function setupPhotoListener() {
                const photosRef = collection(db, `artifacts/${appId}/public/data/wedding-photos`);
                const q = query(photosRef, limit(50)); 
            
                onSnapshot(q, (querySnapshot) => {
                    const photos = [];
                    querySnapshot.forEach((doc) => {
                        photos.push({ id: doc.id, ...doc.data() });
                    });

                    // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ø–æ –¥–∞—Ç–µ (–æ—Ç –Ω–æ–≤—ã—Ö –∫ —Å—Ç–∞—Ä—ã–º)
                    photos.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    
                    photosContainer.innerHTML = ''; // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                    if (photos.length > 0) {
                        photos.forEach((photo) => {
                            displayPhoto(photo.photoData);
                        });
                    } else {
                        photosContainer.innerHTML = '<p class="text-center text-gray-500 col-span-full">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –ø–æ–∫–∞ –Ω–µ—Ç. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º–∏!</p>';
                    }
                });
            }

            // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é
            function displayPhoto(dataUrl) {
                const photoWrapper = document.createElement('div');
                photoWrapper.className = 'relative group rounded-xl overflow-hidden shadow-lg transition-transform transform hover:scale-105';
                
                const img = document.createElement('img');
                img.src = dataUrl;
                img.className = 'w-full h-auto object-cover rounded-xl';
                img.loading = 'lazy'; // –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                
                photoWrapper.appendChild(img);
                photosContainer.appendChild(photoWrapper); // –ò—Å–ø–æ–ª—å–∑—É–µ–º append, —Ç–∞–∫ –∫–∞–∫ —Å–æ—Ä—Ç–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –∑–∞—Ä–∞–Ω–µ–µ
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            captureBtn.addEventListener('click', () => {
                if (!auth.currentUser) {
                    showMessage("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ, –∏–¥–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è...", true);
                    return;
                }
                startCountdown();
            });
        });
    </script>
</body>
</html>
